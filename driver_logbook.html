<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Logbook - Flog Ride</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .logbook-info { margin-bottom: 1.5rem; }
        .log-entry-table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; }
        .log-entry-table th, .log-entry-table td {
            text-align: left; padding: 0.75rem; border-bottom: 1px solid #e5e7eb;
        }
        .log-entry-table th { font-size: 0.8rem; color: #6b7280; text-transform: uppercase; }
        .log-entry-table td { font-size: 0.9rem; }
        .status-driving { color: #16a34a; font-weight: 500; }
        .status-onduty { color: #f59e0b; font-weight: 500; }
        .status-offduty { color: #6b7280; font-weight: 500; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="top-bar">
            <a href="driver_home.html" class="top-bar-icon leading">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </a>
            <h1 class="top-bar-title">Trip Logbook</h1>
            <div class="w-6"></div>
        </div>
        <div class="page-content page-content-with-top-bar">
            <div class="logbook-info">
                <div class="profile-info-item"><p class="profile-info-label">Date</p><p class="profile-info-value" id="logDate">--</p></div>
                <div class="profile-info-item"><p class="profile-info-label">Vehicle VIN</p><p class="profile-info-value" id="logVin">--</p></div>
                <div class="profile-info-item"><p class="profile-info-label">Carrier</p><p class="profile-info-value" id="logCarrier">--</p></div>
                <div class="profile-info-item"><p class="profile-info-label">Main Office</p><p class="profile-info-value" id="logOffice">--</p></div>
            </div>

            <h3 class="text-lg font-semibold text-ngo-blueblack mb-3">Log Entries</h3>
            <div class="overflow-x-auto">
                <table class="log-entry-table">
                    <thead>
                        <tr><th>Status</th><th>Start Time</th><th>End Time</th><th>Location</th></tr>
                    </thead>
                    <tbody id="logEntries">
                        <!-- Log entries will be added here by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="form-section">
                <h3 class="text-lg font-semibold text-ngo-blueblack mb-3">Update Duty Status</h3>
                <div>
                    <label for="dutyStatus" class="form-label">New Duty Status</label>
                    <select id="dutyStatus" class="select-field">
                        <option value="Driving">Driving</option>
                        <option value="On-duty not driving">On-duty not driving</option>
                        <option value="Off-duty">Off-duty (Break)</option>
                    </select>
                </div>
                <div>
                    <label for="currentLocation" class="form-label">Current Location / City</label>
                    <input type="text" id="currentLocation" class="input-field" placeholder="e.g., Lokoja">
                </div>
                <button id="updateStatusBtn" class="btn btn-primary w-full mt-4">Update Status</button>
            </div>
             <div class="mt-6">
                <label for="totalKms" class="form-label">Total KMs Today</label>
                <input type="number" id="totalKms" class="input-field" placeholder="Enter total kilometers for the day">
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mock Data
            const MOCK_TRIP_ID = 'current456';
            const mockLogData = {
                date: new Date().toLocaleDateString('en-CA'), // YYYY-MM-DD format
                vin: 'JT123XYZ789ABC456',
                carrier: 'Save the Children',
                office: '123 Aid Avenue, Abuja, Nigeria',
                totalKms: '',
                entries: [
                    { status: 'On-duty not driving', startTime: '08:00', endTime: '08:30', location: 'Abuja HQ' },
                    { status: 'Driving', startTime: '08:30', endTime: '', location: 'Abuja HQ' }
                ]
            };

            const logEntriesContainer = document.getElementById('logEntries');
            const updateStatusBtn = document.getElementById('updateStatusBtn');
            const totalKmsInput = document.getElementById('totalKms');

            function getLogData() {
                return JSON.parse(sessionStorage.getItem(`logbook_${MOCK_TRIP_ID}`)) || mockLogData;
            }

            function saveLogData(data) {
                sessionStorage.setItem(`logbook_${MOCK_TRIP_ID}`, JSON.stringify(data));
            }

            // Load and render log
            function renderLog() {
                const logData = getLogData();
                
                // Populate header info
                document.getElementById('logDate').textContent = logData.date;
                document.getElementById('logVin').textContent = logData.vin;
                document.getElementById('logCarrier').textContent = logData.carrier;
                document.getElementById('logOffice').textContent = logData.office;
                totalKmsInput.value = logData.totalKms || '';

                logEntriesContainer.innerHTML = '';
                logData.entries.forEach(entry => {
                    const row = document.createElement('tr');
                    const statusClass = `status-${entry.status.split(' ')[0].toLowerCase()}`;
                    row.innerHTML = `
                        <td><span class="${statusClass}">${entry.status}</span></td>
                        <td>${entry.startTime}</td>
                        <td>${entry.endTime}</td>
                        <td>${entry.location}</td>
                    `;
                    logEntriesContainer.appendChild(row);
                });
            }

            // Update status
            updateStatusBtn.addEventListener('click', function() {
                const dutyStatusSelect = document.getElementById('dutyStatus');
                const newStatus = dutyStatusSelect.value;
                const newLocation = document.getElementById('currentLocation').value;
                if (!newLocation) {
                    alert('Please enter your current location.');
                    return;
                }

                const logData = getLogData();
                const currentTime = new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
                
                // Update the last entry's end time
                const lastEntry = logData.entries[logData.entries.length - 1];
                if (lastEntry) {
                    lastEntry.endTime = currentTime;
                }

                // Add the new entry
                logData.entries.push({
                    status: newStatus,
                    startTime: currentTime,
                    endTime: '',
                    location: newLocation
                });
                
                saveLogData(logData);
                document.getElementById('currentLocation').value = '';
                dutyStatusSelect.selectedIndex = 0; // Reset dropdown
                renderLog();
            });

            // EDITED: Save Total KMs when the input changes
            totalKmsInput.addEventListener('change', function() {
                const logData = getLogData();
                logData.totalKms = this.value;
                saveLogData(logData);
            });

            // Initial render
            renderLog();
        });
    </script>
</body>
</html>

